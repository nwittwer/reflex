# Building & releasing Electron w/ Travis https://studiolacosanostra.github.io/2019/03/26/Automate-electron-app-release-build-on-github-with-Travis-CI/
# Env variables for electron-builder codesigning https://www.electron.build/code-signing

language: node_js
node_js: "10"
os: osx
osx_image: xcode10.2

before_cache:
  - rm -rf $HOME/.cache/electron-builder/wine

cache:
  yarn: true
  directories:
    - node_modules
    - $HOME/.cache/electron
    - $HOME/.cache/electron-builder  

# Run on all branches (and PRs)
branches:
  except:
    - "/^v\\d+\\.\\d+\\.\\d+$/"
  # only:
  # - master
  # - dev

jobs:
  include:
    - stage: "Run Tests"
      script:
        - yarn test

    - stage: "Build"
    - name: "Mac"
      if: (branch != master) AND (branch != stable)
      script: yarn run build
      before_cache: rm -rf $HOME/.cache/electron-builder/wine
    - name: "Windows"
      script: yarn run build
      before_cache: rm -rf $HOME/.cache/electron-builder/wine

    - stage: "Release to Github"
      if: (branch = master) OR (branch = stable)
      script: yarn run release
      before_cache: rm -rf $HOME/.cache/electron-builder/wine


    # - stage: Build Mac
    #   if: (branch != master) AND (branch != stable)
    #   script:
    #     - yarn run build
    #   before_cache:
    #     - rm -rf $HOME/.cache/electron-builder/wine
    # - stage: Build Windows
    #   script:
    #     - yarn run build
    #   before_cache:
    #     - rm -rf $HOME/.cache/electron-builder/wine
    # - stage: Release â€” Build Mac, Notarize, Deploy to Github Release 
    #   if: (branch = master) OR (branch = stable)
    #   script:
    #     - yarn run release
    #   before_cache:
    #     - rm -rf $HOME/.cache/electron-builder/wine